<!-- profiles/templates/profiles/pages/dashboard.html -->
{% extends 'global/base.html' %}

{% load i18n %}

{% block title %}Dashboard ({{ user }}) | {% endblock title %}

{% block content %}
  <div class="main-content center container">
    <h2>Dashboard ({{ user }})</h2>

    {% include 'profiles/partials/login_message.html' %}
    {% include 'global/partials/messages.html' %}

    <div class="profiles-dashboard-container">
      {% if user_type == 'Voluntier' %}
        <h3>{% translate 'Find Matching Vacancies' %}</h3>
        <form method="get" action="{% url 'profiles:match' %}">
          {% csrf_token %}
          <div class="form-group">
            <label for="shift">{% translate 'Shift' %}</label>
            <select name="shift" id="shift">
              {% for value, display in form.fields.shift.choices %}
                <option value="{{ value }}" {% if form.data.shift == value %}selected{% endif %}>{{ display }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="country">{% translate 'Country' %}</label>
            <select name="country" id="country">
              {% for value, display in form.fields.country.choices %}
                <option value="{{ value }}" {% if form.data.country == value %}selected{% endif %}>{{ display }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="state">{% translate 'State' %}</label>
            <select name="state" id="state">
              {% for value, display in form.fields.state.choices %}
                <option value="{{ value }}" {% if form.data.state == value %}selected{% endif %}>{{ display }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="city">{% translate 'City' %}</label>
            <select name="city" id="city">
              {% for value, display in form.fields.city.choices %}
                <option value="{{ value }}" {% if form.data.city == value %}selected{% endif %}>{{ display }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="category">{% translate 'Category' %}</label>
            <select name="category" id="category">
              {% for category in form.fields.category.queryset %}
                <option value="{{ category.id }}" {% if form.data.category == category.id %}selected{% endif %}>{{ category.name }}</option>
              {% endfor %}
            </select>
          </div>
          <button type="submit">{% translate 'Match' %}</button>
        </form>
      {% endif %}
      {% if user_type == 'ONG' %}
      <h3>{% translate 'vacancies' %}</h3>
        <ul>
          {% for vacancy in vacancies %}
            <li>
              <a href="{% url 'profiles:dashboard_vacancy_edit' vacancy.id %}">{{ vacancy.title }}</a>
              <form class="inline-form form-delete" action="{% url 'profiles:dashboard_vacancy_delete' %}" method='POST'>
                {% csrf_token %}
                <input type="hidden" name="id" value="{{ vacancy.id }}">
                <button class="plaintext-button" type="submit">‚ùå</button>
              </form>
            </li>
          {% empty %}
            <li>
              <p>{% translate 'You do not have any vacancy' %}.</p>
            </li>
          {% endfor %}
        </ul>
      {% elif user_type == 'Voluntier' %}
      <h3>{% translate 'applications' %}</h3>
        <ul>
          {% for application in applications %}
            <li>
              {{ application.vacancy.title }} - {% translate 'application made at' %} {{ application.date }}
            </li>
          {% empty %}
            <li>
              <p>{% translate 'You do not have applied for any vacancy' %}.</p>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p>User type not recognized.</p>
      {% endif %}
    </div>
  </div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const forms = document.querySelectorAll('.form-delete');

      forms.forEach(form => {
        form.addEventListener('submit', function(e) {
          e.preventDefault();
          const confirmed = confirm('Are you sure you want to delete this vacancy?');

          if (confirmed) {
            this.submit();
          }
        });
      });
    });
  </script>
{% endblock content %}
